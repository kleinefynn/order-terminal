import{w as u}from"./index.CPPoq43l.js";import{p as n}from"./ProductService.CLMIA0_R.js";import{p as l}from"./purchases.store.B8M2ZCYD.js";import{p as m}from"./PurchaseRecordsService.BX4yT4NV.js";let s=new Map;const{subscribe:g,set:h,update:d}=u(s),y=async(e,t)=>{try{await n.deleteProductById(t),d(r=>{let a=r.get(e);return a==null||delete a.filter(c=>c.id===t)[0],r})}catch(r){console.error(r)}},f=async e=>{try{let r={id:await n.addProduct(e),...e};d(a=>{let c=a.get(r.category);return c==null||c.push(r),a})}catch(t){console.error(t)}};let b=[{name:"Einzelkarte",price:3,category:"Eintrittskarte"},{name:"Einzelkarte",description:"ermäßigt",price:2,category:"Eintrittskarte"},{name:"Gruppenkarte",price:3,category:"Eintrittskarte"},{name:"Flaschenöffner",price:2.99,category:"Merchendise"},{name:"Superlangertext und bin unkreativ",description:"ermäßigt",price:2.5,category:"Merchendise"},{name:"Schneekugel",price:3,category:"Merchendise"},{name:"Superlangertext und bin unkreativ",price:3,category:"Merchendise"}];n.isInitCompleted.subscribe({complete:async()=>{await w()}});async function w(){let e=await n.getProducts();if(e.length==0){for(const r of b)await n.addProduct(r);e=await n.getProducts()}const t=s;for(const r of e){let a=t.get(r.category);a===void 0&&(a=[],t.set(r.category,a)),a.push(r)}h(s)}const v=()=>Array.from(s.values()),N={subscribe:g,add:f,remove:y,get:v};let o={};const{subscribe:k,set:S,update:i}=u(o),_=e=>{let t=o[e.id];i(r=>(t===void 0?r[e.id]={amount:1,product:{...e}}:r[e.id].amount+=1,r))},P=(e,t)=>{let r=o[e.product.id];if(r===void 0)return;const a=Number(t)<1?1:Number(t);i(c=>(r.amount=a,c))},E=e=>{i(t=>(delete t[e],t))},p=()=>{o={},S(o)},M=async()=>{let e=Object.values(o);e.length!==0&&(e=e.map(t=>({...t.product,amount:t.amount,product_id:t.product.id})),await m.addPurchaseRecord({time:new Date().toISOString(),purchases:e}),await l.refresh(),p())},O={subscribe:k,addItem:_,change:P,remove:E,reset:p,purchase:M};export{N as p,O as w};
