import{w as s}from"./index.Bl2S_yjH.js";import{p as n,a as u}from"./PurchaseRecordsService.Dm-puWxV.js";let p=new Map;const{subscribe:l,set:m,update:d}=s(p),g=async(t,r)=>{try{await n.deleteProductById(r),d(e=>{let c=e.get(t);return c==null||delete c.filter(a=>a.id===r)[0],e})}catch(e){console.error(e)}},y=async t=>{try{let e={id:await n.addProduct(t),...t};d(c=>{let a=c.get(e.category);return a==null||a.push(e),c})}catch(r){console.error(r)}};let b=[{name:"Einzelkarte",price:3,category:"Eintrittskarte"},{name:"Einzelkarte",description:"ermäßigt",price:2,category:"Eintrittskarte"},{name:"Gruppenkarte",price:3,category:"Eintrittskarte"},{name:"Flaschenöffner",price:2.99,category:"Merchendise"},{name:"Superlangertext und bin unkreativ",description:"ermäßigt",price:2.5,category:"Merchendise"},{name:"Schneekugel",price:3,category:"Merchendise"},{name:"Superlangertext und bin unkreativ",price:3,category:"Merchendise"}];n.isInitCompleted.subscribe({complete:async()=>{await h()}});async function h(){let t=await n.getProducts();if(t.length==0){for(const e of b)await n.addProduct(e);t=await n.getProducts()}const r=new Map;for(const e of t){let c=r.get(e.category);c===void 0&&(c=[],r.set(e.category,c)),c.push(e)}m(r)}const $={subscribe:l,add:y,remove:g};let o={};const{subscribe:w,set:f,update:i}=s(o),v=t=>{let r=o[t.id];i(e=>(r===void 0?e[t.id]={amount:1,product:{...t}}:e[t.id].amount+=1,e))},k=(t,r)=>{let e=o[t.product.id];if(e===void 0)return;const c=Number(r)<1?1:Number(r);i(a=>(e.amount=c,a))},S=t=>{i(r=>(delete r[t],r))},M=()=>{o={},f(o)},P=async()=>{let t=Object.values(o);await u.addPurchaseRecord({time:new Date().toISOString(),products:[...t]})},I={subscribe:w,addItem:v,change:k,remove:S,reset:M,purchase:P};export{$ as p,I as w};
